<?php
$tableData = $block->getTableData();
?>

<table class="data-grid">
    <thead>
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Email</th>
            <th>Message</th>
            <th>Created At</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <?php foreach ($tableData as $row): ?>
            <tr>
                <td><?php echo $row['id']; ?></td>
                <td><?php echo $row['name']; ?></td>
                <td><?php echo $row['email']; ?></td>
                <td><?php echo $row['message']; ?></td>
                <td><?php echo $row['created_at']; ?></td>
                <td>
                    
                    
                    <a href="javascript:void(0);" onclick="updateRecord(<?php echo $row['id']; ?>)">Edit</a>

                    <a href="<?php echo $block->getUrl('contactus/contactform/edit', ['id' => $row['id'],'form_key' => $block->getFormKey() ]); ?>">Edit</a> 

        

                    <a href="javascript:void(0);" onclick="deleteRecord(<?php echo $row['id']; ?>)">Delete</a>
                </td>
            </tr>
        <?php endforeach; ?>
    </tbody>
</table>

<script type="text/javascript">

     var FORM_KEY = "<?php echo $block->getFormKey(); ?>";


   require(['jquery'], function ($) {
       window.deleteRecord = function(id) {
        var formKey = window.FORM_KEY; // Get the CSRF form key from Magento's global config
        
        if (confirm('Are you sure you want to delete this record?')) {
            $.ajax({
                url: '<?php echo $block->getUrl('contactus/contactform/delete'); ?>',
                type: 'POST',
                data: {
                    id: id,
                    form_key: formKey
                },
                success: function(response) {
                    if (response.status == 'success') {
                        alert('The record has been deleted.');
                        location.reload(); // Reload the page to reflect changes
                    } else {
                        alert('Error while deleting the record.');
                    }
                },
                error: function(xhr, status, error) {
                    alert('An error occurred while processing your request.');
                }
            });
        }
    }
});



 require(['jquery'], function ($) {
       window.updateRecord = function(id) {
        alert(id);
        var formKey = window.FORM_KEY; // Get the CSRF form key from Magento's global config
        
        if (confirm('Are you sure you want to edit this record?')) {
            $.ajax({
                url: '<?php echo $block->getUrl('contactus/contactform/edit'); ?>',
                type: 'GET',
                data: {
                    id: id,
                    form_key: formKey
                },
                success: function(response) {

                    console.log(response);
                    // alert('ni');
                    // if (response.status == 'success') {
                    //     alert('The record has been deleted.');
                    //     // location.reload(); // Reload the page to reflect changes
                    // } else {
                    //     alert('Error while deleting the record.');
                    // }
                },
                error: function(xhr, status, error) {
                    alert('An error occurred while processing your request.');
                }
            });
        }
    }
});

</script>

